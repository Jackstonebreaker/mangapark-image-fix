<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MangaPark Toolkit — Migration</title>
    <link rel="stylesheet" href="migrate.css" />
  </head>
  <body>
    <!-- Root matches MigrationPanel.tsx: <div className={isDark ? 'dark' : ''}> -->
    <div id="root" class="">
      <div class="min-h-screen bg-background text-foreground">
        <!-- Fixed Header (MigrationPanel.tsx) -->
        <header class="Header sticky top-0 z-10 bg-white dark:bg-panel border-b border-gray-200 dark:border-border px-6 py-4 shadow-sm">
          <div class="HeaderInner flex items-center justify-between max-w-5xl mx-auto">
            <div class="flex items-center gap-6">
              <div>
                <h1 class="mb-0.5" data-i18n="migHeaderTitle">Find Your Manga Elsewhere</h1>
                <p class="text-xs text-muted-foreground" data-i18n="migHeaderSubtitle">Search each title on another site, then add it yourself</p>
              </div>

              <div class="flex items-center gap-4">
                <label class="text-sm text-muted-foreground" data-i18n="migSearchOnLabel">Search on:</label>
                <select id="targetSite" class="Select py-1.5 px-3 bg-white dark:bg-input border border-gray-300 dark:border-border rounded-md text-foreground text-sm focus-ring">
                  <option value="mangadex" data-i18n="migSite_mangadex">MangaDex</option>
                  <option value="anilist" data-i18n="migSite_anilist">AniList</option>
                  <option value="mal" data-i18n="migSite_mal">MyAnimeList</option>
                  <option value="mangaupdates" data-i18n="migSite_mangaupdates">MangaUpdates</option>
                </select>
              </div>

              <label class="flex items-center gap-2 text-sm cursor-pointer">
                <input id="openNewTab" type="checkbox" class="Chk w-4 h-4 rounded border-gray-300 dark:border-border text-blue-600 focus-ring" />
                <span data-i18n="migOpenNewTab">New tab</span>
              </label>
            </div>

            <div class="flex items-center gap-3">
              <!-- Theme toggle (Make parity) -->
              <button id="themeToggleBtn" type="button" class="ThemeToggle" aria-label="Toggle theme" title="Toggle theme" data-i18n-aria-label="themeToggleAria" data-i18n-title="themeToggleTitle">
                <!-- Moon -->
                <svg class="Icon ThemeIconMoon" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"></path>
                </svg>
                <!-- Sun -->
                <svg class="Icon ThemeIconSun" viewBox="0 0 24 24" aria-hidden="true">
                  <circle cx="12" cy="12" r="4"></circle>
                  <path d="M12 2v2"></path>
                  <path d="M12 20v2"></path>
                  <path d="M4.93 4.93l1.41 1.41"></path>
                  <path d="M17.66 17.66l1.41 1.41"></path>
                  <path d="M2 12h2"></path>
                  <path d="M20 12h2"></path>
                  <path d="M6.34 17.66l-1.41 1.41"></path>
                  <path d="M19.07 4.93l-1.41 1.41"></path>
                </svg>
                <span class="sr-only" data-i18n="themeToggleAria">Toggle theme</span>
              </button>

              <!-- Close button: Make has X. We'll wire in migrate.js (minimal). -->
              <button id="closeBtn" type="button" class="Btn ghost IconBtn" aria-label="Close" data-i18n-aria-label="migCloseAria">
                <span aria-hidden="true">✕</span>
              </button>
            </div>
          </div>
        </header>

        <!-- Empty state: MigrationPanelEmpty.tsx (shown when no items) -->
        <div id="empty" class="EmptyState min-h-screen bg-background text-foreground flex items-center justify-center p-6" style="display:none;">
          <div class="max-w-md w-full">
            <div class="bg-white dark:bg-cardDark rounded-lg p-8 border border-gray-200 dark:border-border/50 shadow-lg text-center">
              <div class="flex justify-center mb-6">
                <div class="w-20 h-20 rounded-full bg-blue-50 dark:bg-blue-950/30 flex items-center justify-center">
                  <div class="IconLarge"></div>
                </div>
              </div>

              <h2 class="mb-3" data-i18n="migEmptyTitle">No Library Saved Yet</h2>

              <p class="text-muted-foreground mb-6 text-sm" data-i18n="migEmptyDesc">
                This helper tool searches other sites for your manga. First, you need to save your library.
              </p>

              <div class="bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900/30 rounded-md p-4 mb-6">
                <div class="flex items-start gap-3">
                  <div class="IconSmall mt-0.5"></div>
                  <div class="text-left">
                    <p class="text-sm font-medium text-blue-900 dark:text-blue-300 mb-1" data-i18n="migEmptyStepsTitle">Getting started:</p>
                    <ol class="text-xs text-blue-800 dark:text-blue-300 space-y-1 list-decimal list-inside">
                      <li data-i18n="migEmptyStep1">Close this window</li>
                      <li data-i18n="migEmptyStep2">Click "Save My Library" in the main popup</li>
                      <li data-i18n="migEmptyStep3">Wait a few minutes for it to finish</li>
                      <li data-i18n="migEmptyStep4">Come back here to start finding your manga elsewhere</li>
                    </ol>
                  </div>
                </div>
              </div>

              <button id="goToPopupBtn" type="button" class="Btn primary w-full mb-3" data-i18n="migEmptyGoToPopupBtn">Go to Extension Popup</button>

              <p class="text-xs text-muted-foreground" data-i18n="migEmptySafetyHint">This process is safe and doesn't modify your MangaPark account</p>
            </div>
          </div>
        </div>

        <!-- Main panel content (shown when items exist) -->
        <div id="panel" style="display:none;">
          <!-- Main Content -->
          <main class="Main px-6 py-8 transition-all duration-300" id="mainContent">
            <div class="max-w-3xl mx-auto">
              <!-- Position Counter -->
              <div class="mb-6 text-center">
                <div class="inline-flex items-baseline gap-2 px-4 py-2 bg-blue-50 dark:bg-blue-950/30 rounded-lg border border-blue-200 dark:border-blue-900/30">
                  <span class="text-3xl font-bold text-blue-600 dark:text-blue-400" id="currentIndexNum">1</span>
                  <span class="text-lg text-muted-foreground" aria-hidden="true">/</span>
                  <span class="text-lg text-muted-foreground" id="totalIndexNum">0</span>
                  <!-- Legacy required IDs (kept, but not shown) -->
                  <span id="indexLabel" class="sr-only">0/0</span>
                  <span id="storedCount" class="sr-only">0</span>
                </div>
              </div>

              <!-- Current Manga Card -->
              <div class="bg-white dark:bg-cardDark rounded-lg border-2 border-gray-200 dark:border-border/50 shadow-sm p-8 mb-6">
                <!-- Title -->
                <div class="text-center mb-8">
                  <h2 class="text-4xl font-bold mb-2 leading-tight" id="title">-</h2>
                  <p class="text-lg text-muted-foreground" id="altTitle" style="display:none;">-</p>
                </div>

                <!-- Metadata (we only have partial data; placeholders kept) -->
                <div class="flex items-center justify-center gap-6 mb-8 text-sm text-muted-foreground">
                  <div class="flex items-center gap-1.5">
                    <div class="MetaIcon"></div>
                    <span id="chaptersMeta" data-i18n="migMetaChaptersFmt">- chapters</span>
                  </div>
                  <div class="flex items-center gap-1.5">
                    <div class="MetaIcon"></div>
                    <span id="statusMeta">-</span>
                  </div>
                </div>

                <!-- Primary Action -->
                <div class="mb-6">
                  <button id="searchBtn" type="button" class="Btn primary w-full py-4 text-lg font-semibold" data-i18n="migSearchBtn">Search on MangaDex →</button>
                  <p class="text-center text-xs text-muted-foreground mt-2">
                    <span data-i18n="migSearchHintPrefix">Opens</span> <span id="searchSiteName">MangaDex</span> <span data-i18n="migSearchHintSuffix">search • Press</span>
                    <kbd class="kbd px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 rounded border border-gray-300 dark:border-gray-700 font-mono text-xs" data-i18n="keyEnter">Enter</kbd>
                  </p>
                </div>

                <!-- Navigation -->
                <div class="mb-6">
                  <div class="grid grid-cols-2 gap-3">
                    <button id="prevBtn" type="button" class="Btn secondary py-3 flex items-center justify-center gap-2 font-medium">
                      <span data-i18n="migPrevBtn">Previous</span>
                    </button>
                    <button id="nextBtn" type="button" class="Btn secondary py-3 flex items-center justify-center gap-2 font-medium">
                      <span data-i18n="migNextBtn">Next</span>
                    </button>
                  </div>
                  <p class="text-center text-xs text-muted-foreground mt-2">
                    <span data-i18n="migNavHintPrefix">Or use</span>
                    <kbd class="kbd px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 rounded border border-gray-300 dark:border-gray-700 font-mono text-xs">←</kbd>
                    <kbd class="kbd px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 rounded border border-gray-300 dark:border-gray-700 font-mono text-xs">→</kbd>
                    <span data-i18n="migNavHintSuffix">arrow keys</span>
                  </p>
                </div>

                <!-- Secondary Actions -->
                <div class="border-t border-gray-200 dark:border-border/30 pt-4">
                  <p class="text-xs text-muted-foreground mb-2 text-center" data-i18n="migOtherActionsTitle">Other actions</p>
                  <div class="grid grid-cols-2 gap-2">
                    <button id="copyBtn" type="button" class="Btn ghost flex items-center justify-center gap-2 text-sm py-2" data-i18n="migCopyBtn">Copy Title</button>
                    <button id="removeBtn" type="button" class="Btn ghost flex items-center justify-center gap-2 text-sm py-2 text-red-600 dark:text-red-400" data-i18n="migRemoveBtn">Skip This One</button>
                  </div>

                  <div class="mt-2 grid grid-cols-3 gap-2" aria-label="Data actions">
                    <button id="exportCsvBtn" type="button" class="Btn secondary" style="font-size: 12px; padding: 6px 10px;" data-i18n="migExportCsvBtn">Export CSV</button>
                    <button id="exportJsonBtn" type="button" class="Btn secondary" style="font-size: 12px; padding: 6px 10px;" data-i18n="migExportJsonBtn">Export JSON</button>
                    <button id="clearAllBtn" type="button" class="Btn ghost text-red-600 dark:text-red-400" style="font-size: 12px; padding: 6px 10px;" data-i18n="migClearAllBtn">Clear all</button>
                  </div>
                </div>

                <!-- Hidden legacy fields required by migrate.js -->
                <div class="sr-only" aria-hidden="true">
                  <a id="sourceLink" target="_blank" rel="noreferrer" aria-disabled="true" tabindex="-1">-</a>
                  <span id="lastRead">-</span>
                  <span id="capturedAt">-</span>
                  <div id="error"></div>
                </div>
              </div>

              <!-- Quick Stats -->
              <div class="bg-gray-50 dark:bg-panel rounded-lg p-4 border border-gray-200 dark:border-border/30">
                <div class="grid grid-cols-3 gap-4 text-center text-sm">
                  <div>
                    <p class="text-muted-foreground mb-1" data-i18n="migStatsRemaining">Remaining</p>
                    <p class="font-semibold text-lg" id="remainingStat">0</p>
                  </div>
                  <div>
                    <p class="text-muted-foreground mb-1" data-i18n="migStatsProgress">Progress</p>
                    <p class="font-semibold text-lg text-blue-600 dark:text-blue-400" id="progressStat">0%</p>
                  </div>
                  <div>
                    <p class="text-muted-foreground mb-1" data-i18n="migStatsTotal">Total</p>
                    <p class="font-semibold text-lg" id="totalStat">0</p>
                  </div>
                </div>
              </div>
            </div>
          </main>

          <!-- Sidebar (Queue) - uses existing IDs from migrate.js: toggleQueueBtn, queuePanel, queueList -->
          <button id="toggleQueueBtn" type="button" class="QueueToggle Btn secondary" data-i18n="migQueueToggleBtn">Library Queue</button>

          <aside id="queuePanel" class="Sidebar" style="display:none;" aria-label="Library Queue">
            <div class="SidebarInner">
              <div class="p-4 border-b border-gray-200 dark:border-border/50">
                <div class="flex items-center justify-between mb-2">
                  <h3 class="text-sm" data-i18n="migQueueTitle">Library Queue</h3>
                  <button id="closeQueueBtn" type="button" class="Btn ghost IconBtn" aria-label="Close queue" data-i18n-aria-label="migCloseQueueAria"><span aria-hidden="true">✕</span></button>
                </div>
                <p class="text-xs text-muted-foreground">
                  <span data-i18n="migQueueShowing">Showing</span> <span id="queueRange">0–0</span> <span data-i18n="migQueueOf">of</span> <span id="queueTotal">0</span> <span data-i18n="migQueueItems">items</span>
                </p>
              </div>

              <div class="flex-1 overflow-y-auto p-4 space-y-2" id="queueList" role="list"></div>

              <div class="p-4 border-t border-gray-200 dark:border-border/50 bg-white/50 dark:bg-panel/50">
                <p class="text-xs text-muted-foreground text-center leading-relaxed" data-i18n="migQueueHint">
                  Click any title to jump there. We show titles near where you are now.
                </p>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </div>

    <script src="migrate_utils.js"></script>
    <script src="migrate.js"></script>
  </body>
</html>

